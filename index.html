<!doctype html>
<html>

    <head>
        <meta charset="utf-8"/>
        <title>SDSLabs CDN</title>
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" media="all" href="style.css"/>
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
		<link rel="icon" href="favicon.ico" type="image/x-icon">
		<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'> 
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <!-- Adding "maximum-scale=1" fixes the Mobile Safari auto-zoom bug: http://filamentgroup.com/examples/iosScaleBug/ -->
       
        <script src="http://cdn.sdslabs.co.in/cdnjs/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script src="http://cdn.sdslabs.co.in/cdnjs/ajax/libs/underscore.js/1.1.4/underscore-min.js"></script>
        <script src="http://cdn.sdslabs.co.in/cdnjs/ajax/libs/backbone.js/0.3.3/backbone-min.js"></script>
        <script src="http://cdn.sdslabs.co.in/cdnjs/ajax/libs/waypoints/1.0.2/waypoints.min.js"></script>
        <script type="text/javascript">
        
        
        
        $(document).ready( function(){
            Package = Backbone.Model.extend({
                
            });
            
            Packages = Backbone.Collection.extend({
                model: Package
            });            
            SiteController = Backbone.Controller.extend({
                routes: {
                    "/search/author/:author":    "authorsearch",
                    "/search/:term":    "namesearch",
                    "/search/tag/:tag":    "tagsearch",
                    "/page/:page":    "defaultRoute",
                },
                defaultRoute: function( page ){
                    var $this = $(this);
                    target = page;
                    $target = $("#"+target);
                    $('html, body').stop().animate({
                        'scrollTop': $target.offset().top - 120
                    }, 500, 'swing', function() {
                    if( location.hash == "#/page/search" ) {
                        $("#searchinput").focus();
                    }
                });
                },
                tagsearch: function( tag ){
                    $("#searchinput").val("#" + tag);
                    this.appview.searchPackages();
                    $('#searchinput').focus();
                },
                authorsearch: function( author ){
                    $("#searchinput").val("@" + author);
                    this.appview.searchPackages();
                },
                namesearch: function( term ){
                    $("#searchinput").val( term );
                    this.appview.searchPackages();
                }
                
                
            });
            

            packages = new Packages;
            
         
            
            AppView = Backbone.View.extend({
                el: $("#container"),
                initialize: function(){
                    $("#search_form_container").append( _.template( $("#search_form_template").html(), {} ) );
                    $("#searchinput").focus();
                    controller = new SiteController;
                    controller.appview = this;
                    Backbone.history.start();
                    if( $("#searchinput").val() == ""  ){
                    popular = _.select( packages.models, function( result ) {
                       
                        if( _.any( result.get("keywords"), function(tagname){ if( tagname.indexOf("popular") != -1 ) return true;  } ) ){
                            return result;
                        }
                                          
                    })
                    $("#search_results").html( "POPULAR" + _.template( $("#search_results_template").html(), { results: popular } ) );
                }
                },
                events: {
                    "keyup #searchinput": "searchPackages",
                },
                searchPackages: function(e){
                    if( typeof e != "undefined" ){
                    if ( _.any( [37,38,39,40,33,18,34] , function (key){ if( key == e.keyCode ) return true; } ) ) return;
                }
                   // if (e.keyC
                    $('html, body').stop().animate({
                        'scrollTop': "0"
                    }, 500, 'swing', function() {
                       // window.location.hash =  target
                    });
                    var search = $("#searchinput").val();
                    window.location = "#/search/" + search;
                    searches = search.split(" ");
                    searches = _.select( searches, function( search ) { if( search ) return true; } );
                    results = packages.models;
                    for( i = 0; i < searches.length; i ++) {
                            search = searches[i];
                            results = _.select( results, function(jspackage){
                                packagename = jspackage.get("name");
                                tags = jspackage.get("keywords");
                                authors = jspackage.get("maintainers");
                                
                                if(  typeof packagename != "undefined" ){
                                    if( search.indexOf("@") != -1){
                                        
                                        author = search.split("@");
                                        author = author[1];
                                        if( author != "" ){
                                            if( _.any( authors, function(authorname){ if( authorname.name.replace(/ /g, "").toLowerCase().indexOf(author.toLowerCase()) != -1 ) return true;  } ) ){
                                                return jspackage;
                                            }
                                        }
                                    } else if( search.indexOf("#") != -1){
                                        
                                        tag = search.split("#");
                                        tag = tag[1];
                                        if( tag != "" ){
                                            if( tag == "all" || _.any( tags, function(tagname){ if( tagname.indexOf(tag) != -1 ) return true;  } ) ){
                                                return jspackage;
                                            }
                                        }
                                    } else if(packagename.toLowerCase().indexOf(searches[i].toLowerCase()) != -1 ) {
                                        return jspackage;
                                    }
                                }
                                return false;
                            
                            });
                        
                    } 
                    if(  results.length > 0 && searches.length != 0) {
                        $("#search_results").html( _.template( $("#search_results_template").html(), { results: results } ) );
                    } else {
                        $("#search_results").html( "No results found, you can use tags @author and #tag");
                    }
                }
                
            })
            var appview = {};
            $.ajax({ //Start loading packages for search
                url: "packages.json",
                success: function(data ) {
					console.log(data);
                    packages.refresh(data.packages);
                     appview = new AppView;
                }   
            });
            $(".cdnlink").live("click", function(){
                $(this).select();
            });

// Smooth scrolling for internal links
    smoothscroll = function(event) {
    var $this = $(this);
    targetold = this
    target = this.hash.replace("/page/","");
    $target = $(target);
    //alert($target.offset().top)
    $('html, body').stop().animate({
        'scrollTop': $target.offset().top - 120
    }, 500, 'swing', function() {
        if( window.location.hash == "#/page/search" ) {
        $("#searchinput").focus();
    }
        window.location.hash =  targetold.hash
    });
    event.preventDefault();
    return false;
}
$("#searchinput").live("click", function(){
   appview.searchPackages();
});
$("a[href^='#/page']").click(smoothscroll);
 
           
         $('.waypoint').each( function(){
            $(this).waypoint(  function( event, direction ) {
                var $active = $(this);
                
                if (direction === "up") {
                    $active = $active.prev();
                }
                if (!$active.length) $active.end();
             
                $(".active").removeClass("active");
                $('a[waypoint='+$active.attr("id")+']').addClass('active');
                
                
  },{
      "offset": "50%"  
      });
           });

    
        });
        
        
        </script>
    </head>

    <body lang="en">
        <div id="container">
            <div id="header" style="top: 0;position: fixed; left: 50%; width:940px;margin-left: -460px;border: 1px solid #ccc; border-top: none;background: #ebebeb;">
              <div style="float: left;">
              <h1 style="font-size: 3em; font-family: Ubuntu;margin-left: 20px; margin-bottom: 0px">SDSLabs CDN</h1>
              
                </div>
        <div id="search_form_container"></div>
            </div> <!-- jeader -->
        
        <div id="search" class="waypoint">


          

        
        <div class="column">
<div class="column_container">
    <h2 style=" text-align: center; padding:0;font-size: 24px;">What is it?</h2>
              <p style="font-size: 14px;	margin-left: 20px;margin-top: 15px; margin-bottom: 15px; width: 90%">
                Everyone loves the <a target="_blank" href="http://code.google.com/apis/libraries/devguide.html">Google CDN</a> right? Even <a href="http://www.asp.net/ajaxlibrary/cdn.ashx" target="_blank">Microsoft runs their own CDN</a>.<br /><br />The problem is, they only host the most popular libraries.

<br /><br />
We host the other stuff.</p>
<p>This project is a local fork of the cdnjs project.</p>
             <p style="font-size: 14px;"> 
 Our goal is to operate this CDN in a peer reviewed fashion. <br /><br />This means only the highest quality libraries vetted by the community get added to cdnjs.com<br /> 
            <br />All CDNJS code is open source and we welcome users fork request to help maintain an up-to-date collection of Javascript libraries.</p> 
</p> 
<br>
<div class="ribbon">
  <a href="https://github.com/sdslabs/cdnjs" rel="me">Fork sdslabs-cdnjs</a>
</div>

</div> <!-- info column container --> 

        </div>
        <div class="column">
            <div class="column_container">
              <div id="search_results">
            </div>
            </div>
        </div>
    </div> <!-- searc -->
        
       
        <div id="addlibrary" class="waypoint info">
            <div class="column"></div>
            
        </div>
 <!-- container -->
        
        
        <div id="templates" style="display: none;">
        
        
            <script type="text/template" id="search_form_template">
                  <ul class="menu" style="margin-top: 5px;">
                <li>search</li>
                <li><a href="#/search/tag/popular">popular</a></li>
                <li><a href="#/search/tag/all">all</a></li>
                </ul>
                <input type="text" id="searchinput" />
              
            </script>
            <script type="text/template" id="search_results_template">
            <ul>
            <% _.each( results, function( result ) { 
                name = result.get("name");
                version = result.get("version");
                filename = result.get("filename");
                repositories = result.get("repositories");
                homepage = result.get("homepage");
                tags = result.get("keywords");
                maintainers = result.get("maintainers");linka = "http://cdn.sdslabs.co.in/cdnjs/ajax/libs/" + name + "/" + version + "/" + filename;  
                %>
            <li>
           
                <h3>
                    <span><a target="_blank" href="<%= homepage %>"> <%= name %></a> (<%= version %>)</span
                    <span style="float: right;">
                    <% _.each( repositories, function( repo ) { %>
                    <!--<a href="<%= repo.url %>" target="_blank"><img src="images/<%= repo.type %>.png" /></a>-->
                    <% }); %>
                    
                    </span>
                </h3>
            
            <input class="cdnlink" type="text" value="<%= linka %>" />
            <p>Tags: 
            <% _.each( tags, function( tag ) { %>
               <a href="#/search/tag/<%= tag %>"><%= tag %></a>
            <% }); %>
            </p>
            <p>Maintainers: 
            <% _.each( maintainers, function( maintainer ) { %>
               <a href="#/search/author/<%= maintainer.name.replace(/ /g, "") %>"><%= maintainer.name %></a>
            <% }); %>
            </p>
            </li>
            <% }); %>
            </ul>
            </script>

        </div>

    </body>

</html>
